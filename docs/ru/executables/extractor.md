## Extractor

Экстрактор — класс, выполняющий действие по скачиванию/созданию какой-либо информации и компонованию в [записи](../db/content_unit.md). Наследуется от [Executable](../executables/executable.md).

### Класс

#### Методы

**run()** *async*

Выполняет действия экстрактора

**postRun()** *async*

Перемещение файлов в %storage% и сохранение ContentUnit при write_mode = 1

**thumbnail()**

Создаёт превью для полученных ContentUnit

**execute()**

Алиас run()

#### Шаблон

```
from executables.extractors.Base import BaseExtractor

class Template(BaseExtractor):
    name = 'template'
    category = 'template'
    params = {}

    def setArgs(self, args):
        self.passed_params = args

        super().setArgs(args)

    def onFail(self):
        pass

    async def run(self, args):
        pass

    async def postRun(self):
        pass
```

### Имплементируя

#### Принятие параметров

Экстрактор должен быть рассчитан на возвращение больше одной записи. Например, если вы делаете экстрактор постов из Facebook по id, нужно обеспечить поддержку передачи множества id постов через запятую.

#### В файловой системе

Папка с экстракторами находится в `src/executables/extractors`. Он может находится в любой из под-директорий, но лучше определить его в категорию. Например, если ваш экстрактор возвращает информацию о GitHub-репозитории, лучше создать директорию GitHub, в которой создать файл и класс GithubRepo. Файл определённо должен иметь окончание ".py" и быть написан в camel case. Если вы не хотите, чтобы экстрактор попал в git, создайте его в "Custom".

#### Как класс

Экстрактор должен наследовать класс Base, либо другой класс с "Base" или "Template" в конце.

У него должен быть параметр `name`, дублирующий название класса и файла, `category`, дублирующий директорию категории.

#### Выполнение действия

Действие, выполняемое экстрактором происходит в методе `run()`. Он должен возвращать dict с параметрами `entities` и `collection`.

`entities` — словарь полученных сущностей, которые сохранятся либо сразу после получения (write_mode = 2), либо после окончания работы экстрактора (write_mode = 1). После выполнения так же будут перемещены временные файлы. ContentUnit можно получить с помощью _ContentUnitFromJson()

`collection` — dict, описывающий коллекцию. Если возвращён, все `entities` будут добавлены в данную коллекцию.

#### После выполнения

После выполнения активируется `postRun()`. При write_mode = 1 будут сохранены несохранённые ContentUnit и файлы будут перемещены из временного хранилища.

#### Выполнение других экстракторов

В `run()` можно выполнить другой экстрактор. Для этого может пригодится метод `fork()`

#### asyncio.gather

Для одновременного выполнения действий выполнения другого экстрактора создайте массив __tasks, в который будут помещаться элементы вида:

```
task = asyncio.create_task(self._execute_sub(__extractor, copy.deepcopy(__extractor_params), __final_entities))
```

После создания задач передайте:

```
await asyncio.gather(*tasks, return_exceptions=False)
```
