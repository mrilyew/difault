## Экстракторы

Экстрактор — кастомный класс, выполняющий действие по скачиванию/созданию какой-либо информации

### Класс

#### Методы

**__init__(temp_dir=,del_dir_on_fail=,need_preview=)**

`del_dir_on_fail` = удалить ли папку при неудаче

`need_preview` = нужно ли превью

**setArgs(args?)**

Задаёт параметры

**_fileFromJson({})**
**_entityFromJson({})**
**_collectionFromJson({})**

**run()** *async*

Выполняет действия экстрактора

**postRun()** *async*

Перемещение файлов в %storage% и сохранение Entity при write_mode = 1

**thumbnail()**

Создаёт превью для полученных Entity

**execute()**

Алиас run()

**allocateTemp()**

Внутренний метод для выделения временной папки для File.

#### Шаблон

```
from executables.extractors.Base import BaseExtractor

class Template(BaseExtractor):
    name = 'template'
    category = 'template'
    params = {}

    def setArgs(self, args):
        self.passed_params = args

        super().setArgs(args)

    def onFail(self):
        pass

    async def run(self, args):
        pass

    async def postRun(self):
        pass
```

### Создавая экстрактор

#### В файловой системе

Папка с экстракторами находится в `src/executables/extractors`. Он может находится в любой из под-директорий, но лучше определить его в категорию. Например, если ваш экстрактор возвращает информацию о GitHub-репозитории, лучше создать директорию GitHub, в которой создать файл и класс GithubRepo. Файл определённо должен иметь окончание ".py" и быть написан в camel case. Если вы не хотите, чтобы экстрактор попал в git, создайте его в "Custom".

#### Как класс

Экстрактор должен наследовать класс Base, либо другой класс с "Base" или "Template" в конце.

У него должен быть параметр `name`, дублирующий название класса и файла, `category`, дублирующий директорию категории.

#### Передача параметров

Для передачи параметров используется метод `setArgs(args?)`. Однако применятся только параметры, описанные в методе `declare()`.

##### Декларирование параметров

Экстрактор рекурсивно определяет нужные параметры из родительских классов из метода `declare()`.

Он должен быть статическим (без self) и возвращать словарь с ключами параметров в виде:

`desc_key` — ключ локализации, отвечающий за описание параметра в интерфейсе. Можно не заполнять.

---

`type` — тип параметра. Возможные значения:

`int`, `float` — принимается число

`array` — Значение может быть только из перечисленных в массиве.

`string` — принимается строка

`object` — python объект; может быть задан только внутри кода.

`bool` — false/true

---

`default` — какое значение будет задано, если параметр не передан

---

`hidden` — True/False; параметр скрыт из интерфейса

---

`assertion` — словарь, отвечающий за функцию assert:

`assert_not_null` со значением True — будет проверка значение на неравность None.

`assert_link` — значение будет привязано к указанному параметру, назовём X. Если текущий параметр равен None, будет проверятся параметр X, если он тоже равен None, будет возвращено AssertionError.

`only_when` — массив с проверками на равность других параметров.

---

`maxlength` — максимальная длина значения, только при `type` = `string`. 

При `manual_params`=True применятся все переданные параметры.

#### Выполнение действия

Действие, выполняемое экстрактором происходит в методе `run()`. Он должен возвращать dict с параметрами `entities` и `collection`.

`entities` — словарь полученных сущностей, которые сохранятся либо сразу после получения (write_mode = 2), либо после окончания работы экстрактора (write_mode = 1). После выполнения так же будут перемещены временные файлы. Entity можно получить с помощью _entityFromJson()

`collection` — dict, описывающий коллекцию. Если возвращён, все `entities` будут добавлены в данную коллекцию.

#### После выполнения

После выполнения активируется `postRun()`. При write_mode = 1 будут сохранены несохранённые Entity и файлы будут перемещены из временного хранилища.

#### Источник (describeSource)

...

#### Выполнение других экстракторов

В `run()` можно выполнить другой экстрактор. Для этого может пригодится метод `fastGetEntity()`, но он не рекомендуется. Пример его использования можно найти в Vk.VkPost на 168 строке.
